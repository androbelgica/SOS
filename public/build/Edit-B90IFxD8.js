import{q as A,r as m,v as j,R as e,$ as D,Y as G,a as R}from"./app2.js";import{M as L}from"./MainLayout-B06OhM-w.js";import{I as i}from"./InputLabel-BvFC6EAv.js";import{T as k,I as c}from"./InputError-ChmX8D1f.js";import{C as B}from"./CameraCapture-CA1dmMnc.js";import"./FlashMessage-CcTVzuzS.js";import"./NotificationDropdown-Bq8s4d9o.js";import"./transition-Cpe-sHT0.js";import"./XMarkIcon-Dw0WrAo0.js";import"./dialog-D-Cuu6HU.js";function ee({auth:w,product:a,recipes:_,categories:x,timestamp:C}){const{asset:M}=A().props,[I,O]=m.useState(Date.now()),f=C||I,[d,g]=m.useState(null),[E,v]=m.useState(!1),[h,u]=m.useState(null),[P,b]=m.useState(!1);m.useEffect(()=>{if(a.image_url){console.log(`Product image URL: ${a.image_url}`);const t=new Image;t.onload=()=>console.log("âœ… Product image loaded successfully"),t.onerror=n=>console.error(`âŒ Failed to load product image: ${a.image_url}`,n),t.src=a.image_url}},[a.image_url]);const q=async()=>{var t,n;if(!r.name||r.name.trim()===""){u("Please enter a product name first");return}v(!0),u(null);try{const l=await R.post(route("api.ai.generate-product-info"),{product_name:r.name});l.data.success?s({...r,description:l.data.description||r.description,nutritional_facts:l.data.nutritional_facts||r.nutritional_facts}):u(l.data.message||"Failed to generate product information")}catch(l){console.error("AI Generation Error:",l),u(((n=(t=l.response)==null?void 0:t.data)==null?void 0:n.message)||"An error occurred during generation")}finally{v(!1)}},{data:r,setData:s,post:F,processing:N,errors:o,progress:p}=j({_method:"PUT",name:a.name,description:a.description,nutritional_facts:a.nutritional_facts||"",price:a.price,stock_quantity:a.stock_quantity,category:a.category,unit_type:a.unit_type||"piece",image:null,recipe_ids:a.recipes.map(t=>t.id)}),$=t=>{const n=t.target.files[0];if(s("image",n),n){const l=new FileReader;l.onload=y=>{g(y.target.result)},l.readAsDataURL(n)}},S=(t,n)=>{s("image",t),g(n),b(!1)},T=()=>{s("image",null),g(null);const t=document.getElementById("image");t&&(t.value="")},U=t=>{t.preventDefault(),F(route("admin.products.update",a.id),{forceFormData:!0,onSuccess:()=>{s("image",null),g(null)}})};return e.createElement(L,{auth:w},e.createElement(D,{title:`Edit ${a.name}`}),e.createElement("div",{className:"py-12"},e.createElement("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8"},e.createElement("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6"},"Edit Product"),e.createElement("form",{onSubmit:U,className:"space-y-6"},e.createElement("div",null,e.createElement(i,{htmlFor:"name",value:"Name"}),e.createElement(k,{id:"name",type:"text",value:r.name,onChange:t=>s("name",t.target.value),className:"mt-1 block w-full",required:!0}),e.createElement(c,{message:o.name,className:"mt-2"})),e.createElement("div",null,e.createElement("div",{className:"flex justify-between items-center"},e.createElement(i,{htmlFor:"description",value:"Description"}),e.createElement("button",{type:"button",onClick:q,disabled:E||!r.name,className:"px-2 py-1 text-xs bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-green-400 dark:focus:ring-offset-gray-800 disabled:opacity-50"},E?"Generating...":"Generate with AI")),e.createElement("textarea",{id:"description",value:r.description,onChange:t=>s("description",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",rows:"4",required:!0}),e.createElement(c,{message:o.description,className:"mt-2"})),e.createElement("div",null,e.createElement(i,{htmlFor:"nutritional_facts",value:"Nutritional Facts"}),e.createElement("textarea",{id:"nutritional_facts",value:r.nutritional_facts,onChange:t=>s("nutritional_facts",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",rows:"4",placeholder:"Enter nutritional information such as calories, protein, fats, etc."}),e.createElement(c,{message:o.nutritional_facts,className:"mt-2"})),h&&e.createElement("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded relative",role:"alert"},e.createElement("strong",{className:"font-bold"},"Error: "),e.createElement("span",{className:"block sm:inline"},h)),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},e.createElement("div",null,e.createElement(i,{htmlFor:"price",value:"Price"}),e.createElement(k,{id:"price",type:"number",step:"0.01",value:r.price,onChange:t=>s("price",t.target.value),className:"mt-1 block w-full",required:!0}),e.createElement(c,{message:o.price,className:"mt-2"})),e.createElement("div",null,e.createElement(i,{htmlFor:"stock_quantity",value:"Stock Quantity"}),e.createElement(k,{id:"stock_quantity",type:"number",value:r.stock_quantity,onChange:t=>s("stock_quantity",t.target.value),className:"mt-1 block w-full",required:!0}),e.createElement(c,{message:o.stock_quantity,className:"mt-2"}))),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},e.createElement("div",null,e.createElement(i,{htmlFor:"category",value:"Category"}),e.createElement("select",{id:"category",value:r.category,onChange:t=>s("category",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",required:!0},e.createElement("option",{value:""},"Select a category"),x&&x.map(t=>e.createElement("option",{key:t.value,value:t.value},t.icon," ",t.label))),e.createElement(c,{message:o.category,className:"mt-2"})),e.createElement("div",null,e.createElement(i,{htmlFor:"unit_type",value:"Unit Type"}),e.createElement("select",{id:"unit_type",value:r.unit_type,onChange:t=>s("unit_type",t.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",required:!0},e.createElement("option",{value:"piece"},"By Piece"),e.createElement("option",{value:"kg"},"By Kilogram (kg)")),e.createElement(c,{message:o.unit_type,className:"mt-2"}))),e.createElement("div",null,e.createElement(i,{htmlFor:"image",value:"Product Image"}),e.createElement("div",{className:"flex flex-col sm:flex-row sm:items-center mt-1 space-y-2 sm:space-y-0 sm:space-x-2"},e.createElement("input",{type:"file",id:"image",onChange:$,className:"block w-full text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-50 dark:file:bg-gray-700 file:text-gray-700 dark:file:text-gray-300 hover:file:bg-gray-100 dark:hover:file:bg-gray-600",accept:"image/*"}),e.createElement("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2"},e.createElement("button",{type:"button",onClick:()=>b(!0),className:"px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-green-400 dark:focus:ring-offset-gray-800 whitespace-nowrap"},"ðŸ“· Take Photo"),d&&e.createElement("button",{type:"button",onClick:T,className:"px-4 py-2 bg-red-600 dark:bg-red-500 text-white rounded-md hover:bg-red-700 dark:hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-red-400 dark:focus:ring-offset-gray-800 whitespace-nowrap"},"ðŸ—‘ï¸ Clear"))),e.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"Upload a new image or take a photo with your camera to replace the current image."),p&&e.createElement("div",{className:"mt-2"},e.createElement("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full"},e.createElement("div",{className:"h-full bg-blue-600 dark:bg-blue-500 rounded-full",style:{width:`${p.percentage}%`}})),e.createElement("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1"},p.percentage,"% Uploaded")),e.createElement(c,{message:o.image,className:"mt-2"}),e.createElement("div",{className:"mt-4"},e.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2"},d?"Image Preview:":"Current Image:"),d?e.createElement("div",{className:"relative"},e.createElement("img",{src:d,alt:r.name,className:"h-32 w-32 object-cover rounded-lg border border-gray-200 dark:border-gray-700"}),e.createElement("div",{className:"absolute top-0 right-0 bg-green-500 text-white text-xs px-1 rounded-bl"},"New")):a.image_url?e.createElement("div",{className:"relative"},e.createElement("img",{key:`product-image-${a.id}-${f}`,src:a.image_url.includes("?")?`${a.image_url}&t=${f}`:`${a.image_url}?t=${f}`,alt:r.name,className:"h-32 w-32 object-cover rounded-lg border border-gray-200 dark:border-gray-700",onError:t=>{const n=t.target.parentNode;if(n){const l=document.createElement("div");l.className="h-32 w-32 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-700",l.innerHTML=`<span class="text-gray-700 dark:text-gray-300 font-bold text-2xl">${r.name.charAt(0).toUpperCase()}</span>`,n.replaceChild(l,t.target)}}}),e.createElement("div",{className:"absolute top-0 right-0 bg-blue-500 text-white text-xs px-1 rounded-bl"},a.image_url.startsWith("http")?"External":"Current")):e.createElement("div",{className:"relative"},e.createElement("div",{className:"h-32 w-32 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-700"},e.createElement("span",{className:"text-gray-700 dark:text-gray-300 font-bold text-2xl"},r.name.charAt(0).toUpperCase())),e.createElement("div",{className:"absolute top-0 right-0 bg-gray-500 text-white text-xs px-1 rounded-bl"},"No Image")))),e.createElement("div",null,e.createElement(i,{value:"Associated Recipes"}),e.createElement("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},_.map(t=>e.createElement("label",{key:t.id,className:"flex items-center"},e.createElement("input",{type:"checkbox",value:t.id,checked:r.recipe_ids.includes(t.id),onChange:n=>{const l=n.target.checked?[...r.recipe_ids,t.id]:r.recipe_ids.filter(y=>y!==t.id);s("recipe_ids",l)},className:"rounded border-gray-300 dark:border-gray-700 text-blue-600 dark:text-blue-500 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400 dark:bg-gray-800"}),e.createElement("span",{className:"ml-2 text-gray-700 dark:text-gray-300"},t.title)))),e.createElement(c,{message:o.recipe_ids,className:"mt-2"})),e.createElement("div",{className:"flex items-center justify-end space-x-4"},e.createElement(G,{href:route("admin.products.index"),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 dark:focus:ring-offset-gray-800"},"Cancel"),e.createElement("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-blue-400 dark:focus:ring-offset-gray-800"},N?"Saving...":"Save Changes"))))))),e.createElement(B,{isOpen:P,onClose:()=>b(!1),onCapture:S,title:"Take Product Photo"}))}export{ee as default};
