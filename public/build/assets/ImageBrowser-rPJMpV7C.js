import{r as c,a as w,R as e}from"./app-D84QhpIK.js";import{L as U}from"./dialog-CkzueSQ1.js";import{F as A,a as W}from"./XMarkIcon-Dukj3-QQ.js";import{F as S}from"./CheckCircleIcon-BdsjLafr.js";function P({isOpen:i,onClose:d,onSelect:I,type:l="products",title:N="Select an Image"}){const[x,k]=c.useState([]),[R,h]=c.useState(!0),[p,y]=c.useState(null),[o,j]=c.useState(null);c.useEffect(()=>{i&&v()},[i,l]);const v=async()=>{var r,m;h(!0),y(null);try{let a;try{a=await w.get(route("api.files.images",l)),console.log("API response:",a.data)}catch(s){console.warn("Regular API failed, trying debug endpoint:",s),a=await w.get(`/debug/files/${l}/images`),console.log("Debug API response:",a.data)}const g=(a.data.images||[]).map(s=>{let t=s.url;return!t.startsWith("http")&&!t.startsWith("/")&&(t="/"+t),t=t.replace(/([^:])\/\//g,"$1/"),l==="recipes"&&!t.includes("/recipes/")&&(console.warn("Recipe image URL does not contain /recipes/ path:",t),t.includes("/products/")&&(t=t.replace("/products/","/recipes/"))),console.log(`Image URL for ${l}:`,t),{...s,url:t,original_url:s.url}});k(g),g.length===0&&console.warn("No images found in the response")}catch(a){console.error("Error fetching images:",a),y(((m=(r=a.response)==null?void 0:r.data)==null?void 0:m.error)||"Failed to load images")}finally{h(!1)}},L=()=>{o&&(I(o),d())},E=()=>{v()};return i?e.createElement(U,{open:i,onClose:d,className:"relative z-50"},e.createElement("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),e.createElement("div",{className:"fixed inset-0 flex items-center justify-center p-4"},e.createElement("div",{className:"w-full max-w-4xl rounded-2xl bg-white dark:bg-gray-800 p-6 shadow-xl"},e.createElement("div",{className:"flex justify-between items-center mb-4"},e.createElement("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-white"},N," from ",l==="products"?"Products":"Recipes"," Folder"),e.createElement("div",{className:"flex space-x-2"},e.createElement("button",{type:"button",onClick:E,className:"inline-flex items-center p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"},e.createElement(A,{className:"w-5 h-5"})),e.createElement("button",{type:"button",onClick:d,className:"inline-flex items-center p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"},e.createElement(W,{className:"w-5 h-5"})))),e.createElement("div",{className:"mt-2"},e.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4"},"Select an existing image from the ",l," folder to reuse it."),R?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-white"})):p?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"text-red-500 dark:text-red-400 text-center"},e.createElement("p",{className:"text-lg font-semibold"},"Error"),e.createElement("p",null,p),e.createElement("button",{onClick:E,className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"},"Try Again"))):x.length===0?e.createElement("div",{className:"flex justify-center items-center h-64"},e.createElement("div",{className:"text-gray-500 dark:text-gray-400 text-center"},e.createElement("p",{className:"text-lg font-semibold"},"No Images Found"),e.createElement("p",null,"There are no images in the ",l," folder."))):e.createElement("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-h-96 overflow-y-auto p-2"},x.map((r,m)=>e.createElement("div",{key:m,onClick:()=>j(r),className:`relative cursor-pointer rounded-lg overflow-hidden border-2 transition-all ${(o==null?void 0:o.url)===r.url?"border-blue-500 ring-2 ring-blue-300":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`},e.createElement("img",{src:r.url,alt:r.filename,className:"w-full h-32 object-cover",onLoad:()=>console.log("Image loaded successfully:",r.url),onError:a=>{console.error("Image failed to load:",r.url),a.target.onerror=null,(()=>{const s=r.url.replace("/storage/","/storage/public/");console.log("Trying alternative URL 1:",s);const t=r.url.replace(`/storage/${l}/`,`/storage/public/${l}/`);console.log("Trying alternative URL 2:",t);const n=r.url.replace(`/storage/${l}/`,`/storage/public/public/${l}/`);console.log("Trying alternative URL 3:",n);const u=new Image;u.onload=()=>{console.log("Alternative URL 1 loaded successfully:",s),a.target.src=s},u.onerror=()=>{console.error("Alternative URL 1 failed:",s);const b=new Image;b.onload=()=>{console.log("Alternative URL 2 loaded successfully:",t),a.target.src=t},b.onerror=()=>{console.error("Alternative URL 2 failed:",t);const f=new Image;f.onload=()=>{console.log("Alternative URL 3 loaded successfully:",n),a.target.src=n},f.onerror=()=>{console.error("Alternative URL 3 failed:",n),a.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjYWFhYWFhIj5JbWFnZSBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+"},f.src=n},b.src=t},u.src=s})()}}),(o==null?void 0:o.url)===r.url&&e.createElement("div",{className:"absolute top-2 right-2"},e.createElement(S,{className:"w-6 h-6 text-blue-500 bg-white rounded-full"})),e.createElement("div",{className:"p-2 bg-white dark:bg-gray-700 text-xs"},e.createElement("p",{className:"truncate font-medium text-gray-900 dark:text-white"},r.filename),e.createElement("p",{className:"text-gray-500 dark:text-gray-400"},r.size_formatted),e.createElement("p",{className:"text-gray-500 dark:text-gray-400"},r.last_modified_formatted)))))),e.createElement("div",{className:"mt-6 flex justify-end space-x-3"},e.createElement("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600"},"Cancel"),e.createElement("button",{type:"button",onClick:L,disabled:!o,className:`px-4 py-2 text-sm font-medium text-white rounded-md ${o?"bg-blue-600 hover:bg-blue-700":"bg-blue-400 cursor-not-allowed"}`},"Select Image"))))):null}export{P as I};
