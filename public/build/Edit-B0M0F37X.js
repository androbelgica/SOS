import{J as K,r as d,x as ee,R as e,Q as te,t as re,a as h}from"./app2.js";import{M as ae}from"./MainLayout-DLo1xHq3.js";import{I as m}from"./InputLabel-B7p3SMX7.js";import{T as x,I as u}from"./InputError-Cl59onRG.js";import{g as j}from"./imageHelpers-CwpBxbIF.js";import"./FlashMessage-BwSPylXo.js";import"./NotificationDropdown-i8q8POkw.js";import"./transition-CfHd3KDK.js";function fe({auth:S,recipe:l,products:L,timestamp:M}){const{asset:ne}=K().props,[P,se]=d.useState(Date.now()),I=M||P,[b,T]=d.useState(j(l.image_url,I,"recipe")),[w,F]=d.useState(l.video_url?j(l.video_url,I,"recipe"):null),[g,v]=d.useState(l.ingredients||[""]),[f,y]=d.useState(l.instructions||[""]);d.useEffect(()=>{console.log("Edit Recipe component mounted")},[]);const[N,_]=d.useState(!1),[R,C]=d.useState(!1),[A,U]=d.useState(!1),[G,i]=d.useState(null),D=async()=>{var r,a;if(!n.title||n.title.trim()===""){i("Please enter a recipe title first");return}_(!0),i(null);try{const t=await h.post(route("api.ai.generate-recipe-description"),{recipe_title:n.title});t.data.success?s({...n,description:t.data.description||n.description}):i(t.data.message||"Failed to generate recipe description")}catch(t){console.error("AI Description Generation Error:",t),i(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||"An error occurred during description generation")}finally{_(!1)}},W=async()=>{var r,a;if(!n.title||n.title.trim()===""){i("Please enter a recipe title first");return}C(!0),i(null);try{const t=await h.post(route("api.ai.generate-recipe-ingredients"),{recipe_title:n.title});t.data.success&&t.data.ingredients&&t.data.ingredients.length>0?(v(t.data.ingredients),s({...n,ingredients:t.data.ingredients})):i(t.data.message||"Failed to generate recipe ingredients")}catch(t){console.error("AI Ingredients Generation Error:",t),i(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||"An error occurred during ingredients generation")}finally{C(!1)}},V=async()=>{var r,a;if(!n.title||n.title.trim()===""){i("Please enter a recipe title first");return}U(!0),i(null);try{const t=await h.post(route("api.ai.generate-recipe-instructions"),{recipe_title:n.title});t.data.success&&t.data.instructions&&t.data.instructions.length>0?(y(t.data.instructions),s({...n,instructions:t.data.instructions})):i(t.data.message||"Failed to generate recipe instructions")}catch(t){console.error("AI Instructions Generation Error:",t),i(((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.message)||"An error occurred during instructions generation")}finally{U(!1)}},{data:n,setData:s,post:Z,processing:H,errors:c,progress:E}=ee({_method:"PUT",title:l.title,description:l.description,ingredients:l.ingredients||[],instructions:l.instructions||[],cooking_time:l.cooking_time,difficulty_level:l.difficulty_level,image:null,video:null,youtube_url:l.video_url&&(l.video_url.includes("youtube.com")||l.video_url.includes("youtu.be"))?l.video_url:"",product_ids:l.products.map(r=>r.id)}),Q=r=>{const a=r.target.files[0];if(s("image",a),a){const t=new FileReader;t.onload=o=>{T(o.target.result)},t.readAsDataURL(a)}},B=r=>{const a=r.target.files[0];if(s("video",a),a){const t=URL.createObjectURL(a);F(t)}},Y=(r,a)=>{const t=[...g];t[r]=a,v(t),s("ingredients",t.filter(o=>o.trim()!==""))},J=()=>{v([...g,""])},q=r=>{const a=[...g];a.splice(r,1),v(a),s("ingredients",a.filter(t=>t.trim()!==""))},O=(r,a)=>{const t=[...f];t[r]=a,y(t),s("instructions",t.filter(o=>o.trim()!==""))},z=()=>{y([...f,""])},$=r=>{const a=[...f];a.splice(r,1),y(a),s("instructions",a.filter(t=>t.trim()!==""))},X=r=>{r.preventDefault(),s("ingredients",g.filter(a=>a.trim()!=="")),s("instructions",f.filter(a=>a.trim()!=="")),Z(route("admin.recipes.update",l.id),{forceFormData:!0,onSuccess:a=>{s("image",null),s("video",null)}})};return e.createElement(ae,{auth:S},e.createElement(te,{title:`Edit ${l.title}`}),e.createElement("div",{className:"py-12"},e.createElement("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8"},e.createElement("div",{className:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6"},"Edit Recipe"),e.createElement("form",{onSubmit:X,className:"space-y-6"},e.createElement("div",null,e.createElement(m,{htmlFor:"title",value:"Title"}),e.createElement(x,{id:"title",type:"text",value:n.title,onChange:r=>s("title",r.target.value),className:"mt-1 block w-full",required:!0}),e.createElement(u,{message:c.title,className:"mt-2"})),e.createElement("div",null,e.createElement("div",{className:"flex justify-between items-center"},e.createElement(m,{htmlFor:"description",value:"Description"}),e.createElement("button",{type:"button",onClick:D,disabled:N||!n.title,className:"px-2 py-1 text-xs bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-green-400 dark:focus:ring-offset-gray-800 disabled:opacity-50"},N?"Generating...":"Generate with AI")),e.createElement("textarea",{id:"description",value:n.description,onChange:r=>s("description",r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",rows:"4",required:!0}),e.createElement(u,{message:c.description,className:"mt-2"}),G&&e.createElement("div",{className:"mt-2 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-300 px-4 py-3 rounded relative",role:"alert"},e.createElement("strong",{className:"font-bold"},"Error: "),e.createElement("span",{className:"block sm:inline"},G))),e.createElement("div",null,e.createElement(m,{htmlFor:"cooking_time",value:"Cooking Time (minutes)"}),e.createElement(x,{id:"cooking_time",type:"number",min:"1",value:n.cooking_time,onChange:r=>s("cooking_time",r.target.value),className:"mt-1 block w-full",required:!0}),e.createElement(u,{message:c.cooking_time,className:"mt-2"})),e.createElement("div",null,e.createElement(m,{htmlFor:"difficulty_level",value:"Difficulty Level"}),e.createElement("select",{id:"difficulty_level",value:n.difficulty_level,onChange:r=>s("difficulty_level",r.target.value),className:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",required:!0},e.createElement("option",{value:"easy"},"Easy"),e.createElement("option",{value:"medium"},"Medium"),e.createElement("option",{value:"hard"},"Hard")),e.createElement(u,{message:c.difficulty_level,className:"mt-2"})),e.createElement("div",null,e.createElement(m,{htmlFor:"image",value:"Recipe Image"}),e.createElement("div",{className:"mt-2 flex items-center"},b&&e.createElement("div",{className:"mr-4"},e.createElement("img",{src:b,alt:"Preview",className:"h-32 w-32 object-cover rounded-md",onError:r=>{console.error("Image preview failed to load:",b),r.target.onerror=null,(()=>{const t=b.replace("/storage/","/storage/public/");console.log("Trying alternative URL 1:",t);const o=new Image;o.onload=()=>{console.log("Alternative URL 1 loaded successfully:",t),r.target.src=t},o.onerror=()=>{console.error("Alternative URL 1 failed:",t);const p=b.replace("/storage/recipes/","/storage/public/recipes/");console.log("Trying alternative URL 2:",p);const k=new Image;k.onload=()=>{console.log("Alternative URL 2 loaded successfully:",p),r.target.src=p},k.onerror=()=>{console.error("Alternative URL 2 failed:",p),r.target.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmaWxsPSIjYWFhYWFhIj5JbWFnZSBOb3QgRm91bmQ8L3RleHQ+PC9zdmc+"},k.src=p},o.src=t})()}})),e.createElement("input",{id:"image",type:"file",onChange:Q,className:"block w-full text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-50 dark:file:bg-gray-700 file:text-gray-700 dark:file:text-gray-300 hover:file:bg-gray-100 dark:hover:file:bg-gray-600",accept:"image/*"})),e.createElement(u,{message:c.image,className:"mt-2"})),e.createElement("div",null,e.createElement(m,{htmlFor:"video",value:"Recipe Video (Optional)"}),e.createElement("div",{className:"mt-2"},w&&!n.youtube_url&&e.createElement("div",{className:"mb-4"},e.createElement("video",{src:w,controls:!0,className:"h-48 w-full object-cover rounded-md"})),e.createElement("input",{id:"video",type:"file",onChange:B,className:"block w-full text-gray-700 dark:text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-50 dark:file:bg-gray-700 file:text-gray-700 dark:file:text-gray-300 hover:file:bg-gray-100 dark:hover:file:bg-gray-600",accept:"video/mp4,video/quicktime,video/x-msvideo,video/x-flv,video/x-ms-wmv"}),e.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Supported formats: MP4, MOV, AVI, FLV, WMV (max 20MB)")),e.createElement(u,{message:c.video,className:"mt-2"})),e.createElement("div",null,e.createElement(m,{htmlFor:"youtube_url",value:"YouTube Video URL (Optional)"}),e.createElement(x,{id:"youtube_url",type:"url",value:n.youtube_url,onChange:r=>s("youtube_url",r.target.value),className:"mt-1 block w-full",placeholder:"https://www.youtube.com/watch?v=..."}),e.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Enter a YouTube video URL (e.g., https://www.youtube.com/watch?v=...)"),e.createElement(u,{message:c.youtube_url,className:"mt-2"}),n.youtube_url&&e.createElement("div",{className:"mt-4 p-2 border border-gray-200 dark:border-gray-700 rounded-md"},e.createElement("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Current YouTube Video:"),e.createElement("p",{className:"text-sm text-blue-600 dark:text-blue-400 break-all"},n.youtube_url))),E&&e.createElement("div",{className:"mt-2"},e.createElement("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1"},"Uploading files..."),e.createElement("progress",{value:E.percentage,max:"100",className:"w-full"},E.percentage,"%")),e.createElement("div",null,e.createElement("div",{className:"flex justify-between items-center"},e.createElement(m,{value:"Ingredients"}),e.createElement("button",{type:"button",onClick:W,disabled:R||!n.title,className:"px-2 py-1 text-xs bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-green-400 dark:focus:ring-offset-gray-800 disabled:opacity-50"},R?"Generating...":"Generate with AI")),g.map((r,a)=>e.createElement("div",{key:a,className:"flex items-center mt-2"},e.createElement(x,{type:"text",value:r,onChange:t=>Y(a,t.target.value),className:"block w-full",placeholder:`Ingredient ${a+1}`}),e.createElement("button",{type:"button",onClick:()=>q(a),className:"ml-2 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:g.length===1},"Remove"))),e.createElement("button",{type:"button",onClick:J,className:"mt-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"},"Add Ingredient"),e.createElement(u,{message:c.ingredients,className:"mt-2"})),e.createElement("div",null,e.createElement("div",{className:"flex justify-between items-center"},e.createElement(m,{value:"Instructions"}),e.createElement("button",{type:"button",onClick:V,disabled:A||!n.title,className:"px-2 py-1 text-xs bg-green-600 dark:bg-green-500 text-white rounded-md hover:bg-green-700 dark:hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 dark:focus:ring-green-400 dark:focus:ring-offset-gray-800 disabled:opacity-50"},A?"Generating...":"Generate with AI")),f.map((r,a)=>e.createElement("div",{key:a,className:"flex items-start mt-2"},e.createElement("div",{className:"flex-shrink-0 mt-2 mr-2 text-gray-900 dark:text-gray-100"},a+1,"."),e.createElement("textarea",{value:r,onChange:t=>O(a,t.target.value),className:"block w-full rounded-md border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400",rows:"2",placeholder:`Step ${a+1}`}),e.createElement("button",{type:"button",onClick:()=>$(a),className:"ml-2 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300",disabled:f.length===1},"Remove"))),e.createElement("button",{type:"button",onClick:z,className:"mt-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300"},"Add Step"),e.createElement(u,{message:c.instructions,className:"mt-2"})),e.createElement("div",null,e.createElement(m,{value:"Associated Products"}),e.createElement("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},L.map(r=>e.createElement("label",{key:r.id,className:"flex items-center"},e.createElement("input",{type:"checkbox",value:r.id,checked:n.product_ids.includes(r.id),onChange:a=>{const t=a.target.checked?[...n.product_ids,r.id]:n.product_ids.filter(o=>o!==r.id);s("product_ids",t)},className:"rounded border-gray-300 dark:border-gray-700 text-blue-600 shadow-sm focus:border-blue-300 dark:focus:border-blue-400 focus:ring focus:ring-blue-200 dark:focus:ring-blue-400"}),e.createElement("span",{className:"ml-2 text-gray-900 dark:text-gray-100"},r.name)))),e.createElement(u,{message:c.product_ids,className:"mt-2"})),e.createElement("div",{className:"flex items-center justify-end mt-4"},e.createElement(re,{href:route("admin.recipes.index"),className:"underline text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 mr-4"},"Cancel"),e.createElement("button",{type:"submit",className:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:border-blue-700 focus:ring focus:ring-blue-300 disabled:opacity-25 transition",disabled:H},"Update Recipe"))))))))}export{fe as default};
