import{r as s,R as e,t as L}from"./app2.js";import{D as $}from"./DeliveryLayout-CJPeP68S.js";import{M as w}from"./Modal-f0Y6x11F.js";import"./NotificationDropdown-i8q8POkw.js";import"./transition-CfHd3KDK.js";import"./dialog-1q41Dkce.js";function z({order:t}){var p,u,k,E;const[N,d]=s.useState(!1),[i,g]=s.useState(!1),C={for_delivery:"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200",out_for_delivery:"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",delivered:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200",cancelled:"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"},_=t.delivery_status==="for_delivery",x=t.delivery_status==="out_for_delivery",[S,D]=s.useState(t.delivery_status),[n,r]=s.useState(!1),[P,m]=s.useState(!1),[c,A]=s.useState(""),[y,F]=s.useState(""),O=["Customer not available","Incorrect address","Customer refused delivery","Unable to contact customer","Other (specify)"],M=async()=>{r(!0);try{await window.axios.post(`/delivery/orders/${t.id}/accept`),window.location.reload()}catch{r(!1),alert("Failed to accept order.")}},R=async a=>{const l=a.target.value;if(D(l),l==="cancelled"){m(!0);return}r(!0);try{l==="delivered"&&await window.axios.post(`/delivery/orders/${t.id}/delivered`),window.location.reload()}catch{r(!1),alert("Failed to update delivery status.")}},U=async()=>{g(!0);try{await window.axios.post(`/delivery/orders/${t.id}/settle-payment`),window.location.reload()}catch{g(!1),alert("Failed to settle payment. Please try again.")}},j=async()=>{r(!0);let a=c==="Other (specify)"?y:c;if(!a){alert("Please provide a reason for cancellation."),r(!1);return}try{await window.axios.post(`/delivery/orders/${t.id}/cancelled`,{reason:a}),m(!1),window.location.reload()}catch{r(!1),alert("Failed to cancel order.")}};return e.createElement($,null,e.createElement("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden"},e.createElement("div",{className:"px-4 py-5 sm:p-6"},e.createElement("div",{className:"flex justify-between items-center mb-6"},e.createElement("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white"},"Order ",t.order_number||"#"+t.id),e.createElement(L,{href:"/delivery/orders",className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all duration-200"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})),"Back to Orders")),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},e.createElement("div",null,e.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Order Information"),e.createElement("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},e.createElement("div",{className:"grid grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Date"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},new Date(t.created_at).toLocaleDateString())),e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Status"),e.createElement("p",{className:"mt-1"},e.createElement("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C[t.delivery_status]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}`},t.delivery_status.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())))),e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Total"),e.createElement("p",{className:"mt-1 text-sm font-medium text-indigo-600 dark:text-indigo-400"},"₱",parseFloat(t.total_amount).toFixed(2))),e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Payment Status"),e.createElement("p",{className:"mt-1"},e.createElement("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.payment_status==="paid"?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200"}`},t.payment_status.charAt(0).toUpperCase()+t.payment_status.slice(1)))),e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Payment Method"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},t.payment_method?t.payment_method.toUpperCase():"N/A"))),_&&e.createElement("button",{className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600",onClick:M,disabled:n},n?"Accepting...":"Accept Order"),e.createElement("div",{className:"mt-4"},e.createElement("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Delivery Status"),e.createElement("select",{value:S,onChange:R,disabled:!x||n,className:"rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white px-2 py-1"},e.createElement("option",{value:"out_for_delivery"},"Out for Delivery"),e.createElement("option",{value:"delivered"},"Delivered"),e.createElement("option",{value:"cancelled"},"Cancelled"))),t.payment_method==="cod"&&t.payment_status!=="paid"&&x&&e.createElement("button",{className:"mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:()=>d(!0)},"Accept Payment (COD)"))),e.createElement("div",null,e.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Customer & Shipping"),e.createElement("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Customer"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},(p=t.user)==null?void 0:p.name," (",(u=t.user)==null?void 0:u.email,")"),e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mt-4"},"Shipping Address"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white whitespace-pre-line"},t.shipping_address),e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mt-4"},"Contact"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},((k=t.user)==null?void 0:k.phone)||"N/A")))),e.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Order Items"),e.createElement("div",{className:"overflow-x-auto"},e.createElement("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},e.createElement("thead",{className:"bg-gray-50 dark:bg-gray-700"},e.createElement("tr",null,e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Product"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Price"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Quantity"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Subtotal"))),e.createElement("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},t.items.map(a=>{var l,o,b,v,f,h;return e.createElement("tr",{key:a.id,className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150"},e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"flex-shrink-0 h-10 w-10"},e.createElement("img",{src:((l=a.product)==null?void 0:l.image_url)||"/images/placeholder.jpg",alt:(o=a.product)==null?void 0:o.name,className:"h-10 w-10 rounded-full object-cover"})),e.createElement("div",{className:"ml-4"},e.createElement("div",{className:"text-sm font-medium text-gray-900 dark:text-white"},(b=a.product)==null?void 0:b.name)))),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400"},"₱",parseFloat(a.price).toFixed(2),((v=a.product)==null?void 0:v.unit_type)==="kg"?"/kg":"/pc")),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"text-sm text-gray-500 dark:text-gray-400"},a.quantity,((f=a.product)==null?void 0:f.unit_type)==="kg"?"g":" pcs")),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"text-sm font-medium text-indigo-600 dark:text-indigo-400"},"₱",(((h=a.product)==null?void 0:h.unit_type)==="kg"?parseFloat(a.price)*(a.quantity/1e3):parseFloat(a.price)*a.quantity).toFixed(2))))})),e.createElement("tfoot",{className:"bg-gray-50 dark:bg-gray-700"},e.createElement("tr",null,e.createElement("td",{colSpan:"3",className:"px-6 py-4 text-right text-sm font-medium text-gray-900 dark:text-white"},"Total:"),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-indigo-600 dark:text-indigo-400"},"₱",parseFloat(t.total_amount).toFixed(2)))))),e.createElement("div",{className:"mt-8"},e.createElement("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"Delivery Details"),e.createElement("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Delivery Status"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},t.delivery_status.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()))),e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Assigned To"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},t.assigned_to?(E=t.user)==null?void 0:E.name:"Unassigned")),t.delivery_status==="cancelled"&&e.createElement("div",{className:"md:col-span-2"},e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Cancellation Reason"),e.createElement("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400"},t.delivery_cancel_reason)),t.delivered_at&&e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Delivered At"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},new Date(t.delivered_at).toLocaleString())),t.cancelled_at&&e.createElement("div",null,e.createElement("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400"},"Cancelled At"),e.createElement("p",{className:"mt-1 text-sm text-gray-900 dark:text-white"},new Date(t.cancelled_at).toLocaleString()))))))),e.createElement(w,{show:N,onClose:()=>d(!1)},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Settle Payment & Complete Delivery"),e.createElement("p",{className:"text-gray-700 dark:text-gray-200 mb-4"},"Are you sure you want to accept payment and mark this order as delivered?"),e.createElement("div",{className:"flex justify-end gap-2 mt-6"},e.createElement("button",{className:"px-4 py-2 rounded bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200",onClick:()=>d(!1),disabled:i},"Cancel"),e.createElement("button",{className:"px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600",onClick:U,disabled:i},i?"Processing...":"Confirm & Settle")))),e.createElement(w,{show:P,onClose:()=>m(!1)},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"Cancel Order"),e.createElement("p",{className:"text-gray-700 dark:text-gray-200 mb-4"},"Please select a reason for cancellation:"),e.createElement("select",{className:"w-full mb-3 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white px-2 py-1",value:c,onChange:a=>A(a.target.value)},e.createElement("option",{value:""},"Select reason"),O.map(a=>e.createElement("option",{key:a,value:a},a))),c==="Other (specify)"&&e.createElement("input",{type:"text",className:"w-full mb-3 rounded border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white px-2 py-1",placeholder:"Enter custom reason",value:y,onChange:a=>F(a.target.value)}),e.createElement("div",{className:"flex justify-end gap-2 mt-6"},e.createElement("button",{className:"px-4 py-2 rounded bg-gray-300 dark:bg-gray-700 text-gray-800 dark:text-gray-200",onClick:()=>m(!1),disabled:n},"Cancel"),e.createElement("button",{className:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700 dark:bg-red-500 dark:hover:bg-red-600",onClick:j,disabled:n},n?"Cancelling...":"Confirm Cancellation")))))}export{z as default};
