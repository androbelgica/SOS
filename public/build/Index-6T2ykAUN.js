import{x as _,r as g,R as e,Q as F,t as b,S as L}from"./app2.js";import{M as j}from"./MainLayout-BWKM2YRe.js";import{b as P}from"./imageHelpers-CwpBxbIF.js";import"./FlashMessage-BwSPylXo.js";import"./NotificationDropdown-i8q8POkw.js";import"./transition-CfHd3KDK.js";function z({auth:v,cartItems:E,total:N}){const{delete:C}=_(),[c,f]=g.useState(E),[i,k]=g.useState(N),[p,x]=g.useState(!1),s=g.useRef([]),d=(t,r,o=!1)=>{if(console.log(`Updating cart item ${t} to quantity ${r}`),isNaN(r)||r<=0){console.error("Invalid quantity:",r);return}const l=c.map(a=>{if(a.id===t){let n;return a.unit_type==="kg"?n=a.price*(r/1e3):n=a.price*r,{...a,quantity:r,subtotal:n}}return a}),h=l.reduce((a,n)=>a+n.subtotal,0);f(l),k(h);const m=new FormData;m.append("quantity",r.toString()),m.append("_method","PATCH"),o&&m.append("redirect_to_checkout","1");let y="";const w=document.querySelector('meta[name="csrf-token"]');if(w)y=w.getAttribute("content");else{const a=document.querySelector('input[name="_token"]');a&&(y=a.value)}const u=fetch(route("cart.update",t),{method:"POST",body:m,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":y}}).then(a=>a.json()).then(a=>(console.log(`Successfully updated cart item ${t} to quantity ${r}`),o&&(window.location.href=route("checkout.index")+"?t="+new Date().getTime()),s.current=s.current.filter(n=>n!==u),a)).catch(a=>{throw console.error(`Failed to update cart item ${t}:`,a),alert("Failed to update cart: "+a),s.current=s.current.filter(n=>n!==u),window.location.reload(),a});return s.current.push(u),u},S=t=>{console.log(`Removing cart item ${t}`);const r=c.filter(l=>l.id!==t),o=r.reduce((l,h)=>l+h.subtotal,0);f(r),k(o),C(route("cart.remove",t))},M=async()=>{if(console.log("Proceeding to checkout"),p){console.log("Already processing checkout, please wait...");return}try{x(!0),s.current.length>0&&(console.log(`Waiting for ${s.current.length} pending cart updates to complete...`),await Promise.all(s.current),console.log("All cart updates completed successfully"));const t={};c.forEach(r=>{t[r.id]=r.quantity}),console.log("Synchronizing cart with server before checkout:",t),L.post(route("cart.sync"),{cartData:t},{preserveScroll:!0,onError:r=>{console.error("Error during cart synchronization:",r),alert("There was an error processing your checkout. Please try again."),x(!1)}})}catch(t){console.error("Error during checkout process:",t),alert("There was an error processing your checkout. Please try again."),x(!1)}};return e.createElement(j,{auth:v,title:"Shopping Cart"},e.createElement(F,{title:"Shopping Cart - Seafood Online Store"}),e.createElement("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden"},e.createElement("div",{className:"px-4 py-5 sm:p-6"},c.length>0?e.createElement(e.Fragment,null,e.createElement("div",{className:"space-y-4"},c.map(t=>e.createElement("div",{key:t.id,className:"flex flex-col sm:flex-row sm:items-center sm:justify-between border-b pb-4 gap-4"},e.createElement("div",{className:"flex items-center space-x-4"},e.createElement("img",{...P({src:t.image_url||"/images/placeholder.jpg",alt:t.name,className:"w-60 h-40 object-contain rounded mx-auto sm:mx-0",type:"product"})}),e.createElement("div",{className:"text-center sm:text-left"},e.createElement("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white"},t.name),e.createElement("p",{className:"text-sm text-gray-500 dark:text-gray-400"},e.createElement("span",{className:"text-indigo-600 dark:text-indigo-400 font-medium"},"₱",t.price!==null&&t.price!==void 0?typeof t.price=="number"?t.price.toFixed(2):parseFloat(t.price||0).toFixed(2):"0.00")," ",t.unit_type==="kg"?"/kg":"/piece"))),e.createElement("div",{className:"flex flex-col sm:flex-row items-center gap-2 sm:gap-4 w-full sm:w-auto"},e.createElement("div",{className:"flex items-center border rounded dark:border-gray-600 mx-auto sm:mx-0"},e.createElement("button",{type:"button",className:"px-3 py-1 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{const r=t.unit_type==="kg"?250:1;d(t.id,Math.max(t.unit_type==="kg"?250:1,t.quantity-r))}},"-"),t.unit_type==="kg"?e.createElement("input",{type:"number",min:"250",step:"250",max:t.stock_quantity*1e3,value:t.quantity,onChange:r=>{const o=parseInt(r.target.value,10);if(!isNaN(o)&&o>=250){const l=Math.round(o/250)*250;d(t.id,l)}},className:"w-20 px-2 py-1 text-center border-x dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"}):e.createElement("input",{type:"number",min:"1",step:"1",max:t.stock_quantity,value:t.quantity,onChange:r=>{const o=parseInt(r.target.value,10);!isNaN(o)&&o>=1&&d(t.id,o)},className:"w-16 px-2 py-1 text-center border-x dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300"}),e.createElement("button",{type:"button",className:"px-3 py-1 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",onClick:()=>{const r=t.unit_type==="kg"?250:1,o=t.unit_type==="kg"?t.stock_quantity*1e3:t.stock_quantity;d(t.id,Math.min(o,t.quantity+r))}},"+")),e.createElement("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-0 sm:ml-2"},t.unit_type==="kg"?"g":"pcs"),e.createElement("span",{className:"text-lg font-semibold text-indigo-600 dark:text-indigo-400"},"₱",t.subtotal!==null&&t.subtotal!==void 0?typeof t.subtotal=="number"?t.subtotal.toFixed(2):parseFloat(t.subtotal||0).toFixed(2):"0.00"),e.createElement("button",{type:"button",onClick:()=>S(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 p-1 rounded-full hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors",title:"Remove item"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"}))))))),e.createElement("div",{className:"mt-8 border-t dark:border-gray-700 pt-6"},e.createElement("div",{className:"flex justify-between items-center text-xl font-semibold"},e.createElement("span",{className:"text-gray-900 dark:text-white"},"Total:"),e.createElement("span",{className:"text-indigo-600 dark:text-indigo-400"},"₱",i!=null?typeof i=="number"?i.toFixed(2):parseFloat(i||0).toFixed(2):"0.00")),e.createElement("div",{className:"mt-6 flex justify-end space-x-4"},e.createElement(b,{href:route("products.index"),className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 transition-all duration-200"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})),"Continue Shopping"),e.createElement("button",{type:"button",onClick:M,disabled:p,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 disabled:opacity-50"},p?e.createElement(e.Fragment,null,e.createElement("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},e.createElement("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.createElement("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})),"Processing..."):e.createElement(e.Fragment,null,e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})),"Proceed to Checkout"))))):e.createElement("div",{className:"text-center py-12"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mx-auto h-16 w-16 text-gray-400 dark:text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})),e.createElement("h3",{className:"mt-4 text-xl font-medium text-gray-900 dark:text-white"},"Your cart is empty"),e.createElement("p",{className:"mt-2 text-gray-500 dark:text-gray-400 max-w-md mx-auto"},"Add some delicious seafood products to your cart and they will appear here."),e.createElement("div",{className:"mt-6"},e.createElement(b,{href:route("products.index"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 dark:bg-indigo-500 hover:bg-indigo-700 dark:hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200"},e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})),"Start Shopping"))))))}export{z as default};
